import 'package:json_annotation/json_annotation.dart';
part 'plant_detail_api_model.g.dart';

@JsonSerializable()
class PlantDetailApiModel {
  final String? cntntsNo;
  final String? plntbneNm;
  final String? plntzrNm;
  final String? distbNm;
  final String? fmlNm;
  final String? fmlCodeNm;
  final String? orgplceInfo;
  final String? adviseInfo;
  final String? imageEvlLinkCours;
  final String? growthHgInfo;
  final String? growthAraInfo;
  final String? lefStleInfo;
  final String? smellCode;
  final String? smellCodeNm;
  final String? toxctyInfo;
  final String? prpgtEraInfo;
  final String? etcEraInfo;
  final String? managelevelCode;
  final String? managelevelCodeNm;
  final String? grwtveCode;
  final String? grwtveCodeNm;
  final String? grwhTpCode;
  final String? grwhTpCodeNm;
  final String? winterLwetTpCode;
  final String? winterLwetTpCodeNm;
  final String? hdCode;
  final String? hdCodeNm;
  final String? frtlzrInfo;
  final String? soilInfo;
  final String? watercycleSprngCode;
  final String? watercycleSprngCodeNm;
  final String? watercycleSummerCode;
  final String? watercycleSummerCodeNm;
  final String? watercycleAutumnCode;
  final String? watercycleAutumnCodeNm;
  final String? watercycleWinterCode;
  final String? watercycleWinterCodeNm;
  final String? dlthtsManageInfo;
  final String? speclmanageInfo;
  final String? fncltyInfo;
  final String? flpodmtBigInfo;
  final String? flpodmtMddlInfo;
  final String? flpodmtSmallInfo;
  final String? widthBigInfo;
  final String? widthMddlInfo;
  final String? widthSmallInfo;
  final String? vrticlBigInfo;
  final String? vrticlMddlInfo;
  final String? vrticlSmallInfo;
  final String? hgBigInfo;
  final String? hgMddlInfo;
  final String? hgSmallInfo;
  final String? volmeBigInfo;
  final String? volmeMddlInfo;
  final String? volmeSmallInfo;
  final String? pcBigInfo;
  final String? pcMddlInfo;
  final String? pcSmallInfo;
  final String? managedemanddoCode;
  final String? managedemanddoCodeNm;
  final String? clCode;
  final String? clCodeNm;
  final String? grwhstleCode;
  final String? grwhstleCodeNm;
  final String? indoorpsncpacompositionCode;
  final String? indoorpsncpacompositionCodeNm;
  final String? eclgyCode;
  final String? eclgyCodeNm;
  final String? lefmrkCode;
  final String? lefmrkCodeNm;
  final String? lefcolrCode;
  final String? lefcolrCodeNm;
  final String? ignSeasonCode;
  final String? ignSeasonCodeNm;
  final String? flclrCode;
  final String? flclrCodeNm;
  final String? fmldeSeasonCode;
  final String? fmldeSeasonCodeNm;
  final String? fmldecolrCode;
  final String? fmldecolrCodeNm;
  final String? prpgtmthCode;
  final String? prpgtmthCodeNm;
  final String? lighttdemanddoCode;
  final String? lighttdemanddoCodeNm;
  final String? postngplaceCode;
  final String? postngplaceCodeNm;
  final String? dlthtsCode;
  final String? dlthtsCodeNm;

  PlantDetailApiModel({
    this.cntntsNo,
    this.plntbneNm,
    this.plntzrNm,
    this.distbNm,
    this.fmlNm,
    this.fmlCodeNm,
    this.orgplceInfo,
    this.adviseInfo,
    this.imageEvlLinkCours,
    this.growthHgInfo,
    this.growthAraInfo,
    this.lefStleInfo,
    this.smellCode,
    this.smellCodeNm,
    this.toxctyInfo,
    this.prpgtEraInfo,
    this.etcEraInfo,
    this.managelevelCode,
    this.managelevelCodeNm,
    this.grwtveCode,
    this.grwtveCodeNm,
    this.grwhTpCode,
    this.grwhTpCodeNm,
    this.winterLwetTpCode,
    this.winterLwetTpCodeNm,
    this.hdCode,
    this.hdCodeNm,
    this.frtlzrInfo,
    this.soilInfo,
    this.watercycleSprngCode,
    this.watercycleSprngCodeNm,
    this.watercycleSummerCode,
    this.watercycleSummerCodeNm,
    this.watercycleAutumnCode,
    this.watercycleAutumnCodeNm,
    this.watercycleWinterCode,
    this.watercycleWinterCodeNm,
    this.dlthtsManageInfo,
    this.speclmanageInfo,
    this.fncltyInfo,
    this.flpodmtBigInfo,
    this.flpodmtMddlInfo,
    this.flpodmtSmallInfo,
    this.widthBigInfo,
    this.widthMddlInfo,
    this.widthSmallInfo,
    this.vrticlBigInfo,
    this.vrticlMddlInfo,
    this.vrticlSmallInfo,
    this.hgBigInfo,
    this.hgMddlInfo,
    this.hgSmallInfo,
    this.volmeBigInfo,
    this.volmeMddlInfo,
    this.volmeSmallInfo,
    this.pcBigInfo,
    this.pcMddlInfo,
    this.pcSmallInfo,
    this.managedemanddoCode,
    this.managedemanddoCodeNm,
    this.clCode,
    this.clCodeNm,
    this.grwhstleCode,
    this.grwhstleCodeNm,
    this.indoorpsncpacompositionCode,
    this.indoorpsncpacompositionCodeNm,
    this.eclgyCode,
    this.eclgyCodeNm,
    this.lefmrkCode,
    this.lefmrkCodeNm,
    this.lefcolrCode,
    this.lefcolrCodeNm,
    this.ignSeasonCode,
    this.ignSeasonCodeNm,
    this.flclrCode,
    this.flclrCodeNm,
    this.fmldeSeasonCode,
    this.fmldeSeasonCodeNm,
    this.fmldecolrCode,
    this.fmldecolrCodeNm,
    this.prpgtmthCode,
    this.prpgtmthCodeNm,
    this.lighttdemanddoCode,
    this.lighttdemanddoCodeNm,
    this.postngplaceCode,
    this.postngplaceCodeNm,
    this.dlthtsCode,
    this.dlthtsCodeNm,
  });

  /// XML to JSON 변환 결과에서 데이터를 안전하게 꺼내는 헬퍼 함수
  static String? _getValue(dynamic node) {
    if (node == null) return null;
    if (node is String) return node;
    if (node is Map<String, dynamic>) {
      // 대표적인 XML→JSON 변환 결과 케이스 대응
      return node['__cdata']?.toString() ?? node['\$t']?.toString();
    }
    return null;
  }

  /// Map<String, dynamic> 형태의 XML→JSON 변환 결과에서 모델 생성
  factory PlantDetailApiModel.fromXmlJson(Map<String, dynamic> json) {
    return PlantDetailApiModel(
      cntntsNo: _getValue(json['cntntsNo']),
      plntbneNm: _getValue(json['plntbneNm']),
      plntzrNm: _getValue(json['plntzrNm']),
      distbNm: _getValue(json['distbNm']),
      fmlNm: _getValue(json['fmlNm']),
      fmlCodeNm: _getValue(json['fmlCodeNm']),
      orgplceInfo: _getValue(json['orgplceInfo']),
      adviseInfo: _getValue(json['adviseInfo']),
      imageEvlLinkCours: _getValue(json['imageEvlLinkCours']),
      growthHgInfo: _getValue(json['growthHgInfo']),
      growthAraInfo: _getValue(json['growthAraInfo']),
      lefStleInfo: _getValue(json['lefStleInfo']),
      smellCode: _getValue(json['smellCode']),
      smellCodeNm: _getValue(json['smellCodeNm']),
      toxctyInfo: _getValue(json['toxctyInfo']),
      prpgtEraInfo: _getValue(json['prpgtEraInfo']),
      etcEraInfo: _getValue(json['etcEraInfo']),
      managelevelCode: _getValue(json['managelevelCode']),
      managelevelCodeNm: _getValue(json['managelevelCodeNm']),
      grwtveCode: _getValue(json['grwtveCode']),
      grwtveCodeNm: _getValue(json['grwtveCodeNm']),
      grwhTpCode: _getValue(json['grwhTpCode']),
      grwhTpCodeNm: _getValue(json['grwhTpCodeNm']),
      winterLwetTpCode: _getValue(json['winterLwetTpCode']),
      winterLwetTpCodeNm: _getValue(json['winterLwetTpCodeNm']),
      hdCode: _getValue(json['hdCode']),
      hdCodeNm: _getValue(json['hdCodeNm']),
      frtlzrInfo: _getValue(json['frtlzrInfo']),
      soilInfo: _getValue(json['soilInfo']),
      watercycleSprngCode: _getValue(json['watercycleSprngCode']),
      watercycleSprngCodeNm: _getValue(json['watercycleSprngCodeNm']),
      watercycleSummerCode: _getValue(json['watercycleSummerCode']),
      watercycleSummerCodeNm: _getValue(json['watercycleSummerCodeNm']),
      watercycleAutumnCode: _getValue(json['watercycleAutumnCode']),
      watercycleAutumnCodeNm: _getValue(json['watercycleAutumnCodeNm']),
      watercycleWinterCode: _getValue(json['watercycleWinterCode']),
      watercycleWinterCodeNm: _getValue(json['watercycleWinterCodeNm']),
      dlthtsManageInfo: _getValue(json['dlthtsManageInfo']),
      speclmanageInfo: cleanPlantInfo(_getValue(json['speclmanageInfo'])),
      fncltyInfo: _getValue(json['fncltyInfo']),
      flpodmtBigInfo: _getValue(json['flpodmtBigInfo']),
      flpodmtMddlInfo: _getValue(json['flpodmtMddlInfo']),
      flpodmtSmallInfo: _getValue(json['flpodmtSmallInfo']),
      widthBigInfo: _getValue(json['WIDTH_BIG_INFO']),
      widthMddlInfo: _getValue(json['widthMddlInfo']),
      widthSmallInfo: _getValue(json['widthSmallInfo']),
      vrticlBigInfo: _getValue(json['vrticlBigInfo']),
      vrticlMddlInfo: _getValue(json['vrticlMddlInfo']),
      vrticlSmallInfo: _getValue(json['vrticlSmallInfo']),
      hgBigInfo: _getValue(json['hgBigInfo']),
      hgMddlInfo: _getValue(json['hgMddlInfo']),
      hgSmallInfo: _getValue(json['hgSmallInfo']),
      volmeBigInfo: _getValue(json['volmeBigInfo']),
      volmeMddlInfo: _getValue(json['volmeMddlInfo']),
      volmeSmallInfo: _getValue(json['volmeSmallInfo']),
      pcBigInfo: _getValue(json['pcBigInfo']),
      pcMddlInfo: _getValue(json['pcMddlInfo']),
      pcSmallInfo: _getValue(json['pcSmallInfo']),
      managedemanddoCode: _getValue(json['managedemanddoCode']),
      managedemanddoCodeNm: _getValue(json['managedemanddoCodeNm']),
      clCode: _getValue(json['clCode']),
      clCodeNm: _getValue(json['clCodeNm']),
      grwhstleCode: _getValue(json['grwhstleCode']),
      grwhstleCodeNm: _getValue(json['grwhstleCodeNm']),
      indoorpsncpacompositionCode: _getValue(json['indoorpsncpacompositionCode']),
      indoorpsncpacompositionCodeNm: _getValue(json['indoorpsncpacompositionCodeNm']),
      eclgyCode: _getValue(json['eclgyCode']),
      eclgyCodeNm: _getValue(json['eclgyCodeNm']),
      lefmrkCode: _getValue(json['lefmrkCode']),
      lefmrkCodeNm: _getValue(json['lefmrkCodeNm']),
      lefcolrCode: _getValue(json['lefcolrCode']),
      lefcolrCodeNm: _getValue(json['lefcolrCodeNm']),
      ignSeasonCode: _getValue(json['ignSeasonCode']),
      ignSeasonCodeNm: _getValue(json['ignSeasonCodeNm']),
      flclrCode: _getValue(json['flclrCode']),
      flclrCodeNm: _getValue(json['flclrCodeNm']),
      fmldeSeasonCode: _getValue(json['fmldeSeasonCode']),
      fmldeSeasonCodeNm: _getValue(json['fmldeSeasonCodeNm']),
      fmldecolrCode: _getValue(json['fmldecolrCode']),
      fmldecolrCodeNm: _getValue(json['fmldecolrCodeNm']),
      prpgtmthCode: _getValue(json['prpgtmthCode']),
      prpgtmthCodeNm: _getValue(json['prpgtmthCodeNm']),
      lighttdemanddoCode: _getValue(json['lighttdemanddoCode']),
      lighttdemanddoCodeNm: _getValue(json['lighttdemanddoCodeNm']),
      postngplaceCode: _getValue(json['postngplaceCode']),
      postngplaceCodeNm: _getValue(json['postngplaceCodeNm']),
      dlthtsCode: _getValue(json['dlthtsCode']),
      dlthtsCodeNm: _getValue(json['dlthtsCodeNm']),
    );
  }

  static String cleanPlantInfo(String? raw) {
    if (raw == null) return '';

    String s = raw;

    // 1) HTML 태그 제거 (필요하면)
    s = s.replaceAll(RegExp(r'<br\s*/?>', caseSensitive: false), '\n');
    s = s.replaceAll(RegExp(r'<[^>]+>'), '');

    // 2) \\ 역슬래시 문자 완전 제거
    s = s.replaceAll('\\', '');

    // 3) 'rnrn' 연속 반복을 실제 개행으로 바꾸기
    // (r, n이 여러 번 반복되면 모두 개행으로 치환)
    s = s.replaceAll(RegExp(r'(rn)+'), '\n');

    // 4) 연속된 줄바꿈 3개 이상 → 2개로 축소
    s = s.replaceAll(RegExp(r'\n{3,}'), '\n\n');

    // 5) 앞뒤 공백 제거
    s = s.trim();

    return s;
  }

  factory PlantDetailApiModel.fromJson(Map<String, dynamic> json) =>
      _$PlantDetailApiModelFromJson(json);

  Map<String, dynamic> toJson() => _$PlantDetailApiModelToJson(this);
}
